# –°–æ—Å—Ç–æ—è–Ω–∏–µ - State

–ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π

**–°–æ—Å—Ç–æ—è–Ω–∏–µ**¬†‚Äî —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–∞–º –º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–≤–æ–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ò–∑–≤–Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª—Å—è –∫–ª–∞—Å—Å¬†–æ–±—ä–µ–∫—Ç–∞.

---

# üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

![image.png](%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5%20-%20State%20282616f297f048e6a9f440fb1600977a/image.png)

1. **Context**¬†—Ö—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –µ–º—É —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã, –∑–∞–≤–∏—Å—è—â–µ–π –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π. –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —ç—Ç–∏–º –æ–±—ä–µ–∫—Ç–æ–º —á–µ—Ä–µ–∑ –æ–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π. –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è –µ–º—É –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞-—Å–æ—Å—Ç–æ—è–Ω–∏—è.
2. **State**¬†–æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π.
3. **Concrete States**¬†—Ä–µ–∞–ª–∏–∑—É—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ò–Ω–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ü–µ–ª—ã–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–ª–∞—Å—Å–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π, —á—Ç–æ–±—ã –æ–±–æ–±—â–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥.
    
    –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ß–µ—Ä–µ–∑ –Ω–µ—ë –Ω–µ —Ç–æ–ª—å–∫–æ —É–¥–æ–±–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–æ –∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Å–º–µ–Ω—É –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
    
4. –ò –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏ –æ–±—ä–µ–∫—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –º–æ–≥—É—Ç —Ä–µ—à–∞—Ç—å, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫–æ–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω–æ. –ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω—É–∂–Ω–æ –ø–æ–¥–∞—Ç—å –¥—Ä—É–≥–æ–π –æ–±—ä–µ–∫—Ç-—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.

---

# ‚åó –ü—Å–µ–≤–¥–æ–∫–æ–¥

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–∞—Ç—Ç–µ—Ä–Ω¬†**–°–æ—Å—Ç–æ—è–Ω–∏–µ**¬†–∏–∑–º–µ–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª–µ–º, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –≤ –∫–∞–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–µ–π—á–∞—Å –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å.

![image.png](%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5%20-%20State%20282616f297f048e6a9f440fb1600977a/image%201.png)

–û–±—ä–µ–∫—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—ä–µ–∫—Ç-—Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–º—É –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ä–∞–±–æ—Ç—É. –ò–∑–º–µ–Ω—è—è —Å–æ—Å—Ç–æ—è–Ω–∏—è, –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ç–æ, –∫–∞–∫ –≤–µ–¥—É—Ç —Å–µ–±—è —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—è.

```
// –û–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π.
abstract class State is
	protected field player: AudioPlayer

  // –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç —Å–µ–±—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è, —á—Ç–æ–±—ã
  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–≥–ª–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –µ–≥–æ –¥–∞–Ω–Ω—ã–º –∏ –º–µ—Ç–æ–¥–∞–º –≤
  // –±—É–¥—É—â–µ–º, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.
	constructor State(player) is
		this.player = player

	abstract method clickLock()
	abstract method clickPlay()
	abstract method clickNext()
	abstract method clickPrevious()

// –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–∞–ª–∏–∑—É—é—Ç –º–µ—Ç–æ–¥—ã –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
// –ø–æ-—Å–≤–æ–µ–º—É.
class LockedState extends State is
	// –ü—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –ø—Ä–æ–∏–≥—Ä–æ–≤–∞—Ç–µ–ª—è —Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
  // –∫–ª–∞–≤–∏—à–∞–º–∏ –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –æ–¥–Ω–æ –∏–∑ –¥–≤—É—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π.
	method clickLock() is
		if (player.playing)
	    player.changeState(new PlayingState(player))
		else
			player.changeState(new ReadyState(player))

	method clickPlay() is
		// –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å.

	method clickNext() is
		// –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å.

	method clickPrevious() is
		// –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å.

// –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∞–º–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –¥—Ä—É–≥–æ–µ
// —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
class ReadyState extends State is
	method clickLock() is
		player.changeState(new LockedState(player))

	method clickPlay() is
		player.startPlayback()
    player.changeState(new PlayingState(player))

	method clickNext() is
		player.nextSong()

	method clickPrevious() is
		player.previousSong()

class PlayingState extends State is
	method clickLock() is
		player.changeState(new LockedState(player))

	method clickPlay() is
		player.stopPlayback()
    player.changeState(new ReadyState(player))

	method clickNext() is
		if (event.doubleclick)
	    player.nextSong()
		else
			player.fastForward(5)

	method clickPrevious() is
		if (event.doubleclick)
	    player.previous()
		else
			player.rewind(5)

// –ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
class AudioPlayer is
	field state: State
	field UI, volume, playlist, currentSong

	constructor AudioPlayer() is
		this.state =new ReadyState(this)

    // –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞
    // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –≤–º–µ—Å—Ç–æ —Å–µ–±—è. –†–µ–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å
    // —Ä–∞–∑–Ω–æ–π, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ–π—á–∞—Å
    // –∞–∫—Ç–∏–≤–Ω–æ.
    UI =new UserInterface()
    UI.lockButton.onClick(this.clickLock)
    UI.playButton.onClick(this.clickPlay)
    UI.nextButton.onClick(this.clickNext)
    UI.prevButton.onClick(this.clickPrevious)

  // –î—Ä—É–≥–∏–µ –æ–±—ä–µ–∫—Ç—ã —Ç–æ–∂–µ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω—è—Ç—å
  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—è.
	method changeState(state: State) is
		this.state = state

  // –ú–µ—Ç–æ–¥—ã UI –±—É–¥—É—Ç –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∞–∫—Ç–∏–≤–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.
	method clickLock() is
		state.clickLock()
	method clickPlay() is
		state.clickPlay()
	method clickNext() is
		state.clickNext()
	method clickPrevious() is
		state.clickPrevious()

  // –°–µ—Ä–≤–∏—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –≤—ã–∑—ã–≤–∞–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏.
	method startPlayback() is
		// ...
	method stopPlayback() is
		// ...
	method nextSong() is
		// ...
	method previousSong() is
		// ...
	method fastForward(time) is
		// ...
	method rewind(time) is
		// ...
```